# 修仙模拟器数值平衡方案（最终确认版）

## 问题分析

### 问题：后期属性爆炸导致无法触发死亡事件

**当前机制：**

#### 死亡事件伤害
```javascript
damage = (realmIdx + 1) * 10
```
- 凡人: 10
- 炼气: 20
- ...
- 真仙: 110

#### 气运豁免
```javascript
豁免几率 = min(气运 * 0.5, 50)
```
- 气运100 → 50%豁免
- 气运200 → 100%豁免（上限50%）

**问题根源：**
1. 死亡伤害是固定值，不随体质增长
2. 后期体质可能达到几百甚至上千，死亡伤害几乎无影响
3. 高气运可以完全豁免死亡事件

---

## 最终确认方案（仅2项调整）

### 调整项1：死亡事件伤害与体质挂钩

**目标：** 让死亡伤害随体质增长，避免后期无敌

**调整：**
```javascript
// src/game-engine.js 第969行
// 当前: const damage = (s.realmIdx + 1) * 10;
// 改为: const damage = Math.max(10, Math.floor(s.stats.tizhi * 0.7));
```

**效果：**
- 体质10: 伤害7→10（最低）
- 体质50: 伤害35
- 体质100: 伤害70
- 体质200: 伤害140
- 体质500: 伤害350

### 调整项2：气运豁免削弱

**目标：** 降低高气运的豁免能力

**调整：**
```javascript
// src/game-engine.js 第963行
// 当前: const qiyunCheckChance = Math.min((s.stats.qiyun || 0) * 0.5, 50);
// 改为: const qiyunCheckChance = Math.min((s.stats.qiyun || 0) * 0.3, 40);
```

**效果：**
- 气运50: 15%豁免（原25%）
- 气运100: 30%豁免（原50%）
- 气运134: 40%豁免（原50%）
- 气运200: 40%豁免（原50%）

---

## 具体修改清单

### src/game-engine.js

#### 修改1：死亡事件伤害（第969行）
```javascript
// 当前
const damage = (s.realmIdx + 1) * 10;

// 改为
const damage = Math.max(10, Math.floor(s.stats.tizhi * 0.7));
```

#### 修改2：气运豁免（第963行）
```javascript
// 当前
const qiyunCheckChance = Math.min((s.stats.qiyun || 0) * 0.5, 50);

// 改为
const qiyunCheckChance = Math.min((s.stats.qiyun || 0) * 0.3, 40);
```

---

## 预期效果

### 后期挑战增加

1. **死亡事件伤害与体质挂钩**
   - 体质越高，死亡伤害越大
   - 后期不再无敌，死亡事件有威胁

2. **气运豁免能力降低**
   - 高气运不再能完全豁免死亡事件
   - 最高豁免率从50%降到40%

### 整体平衡

- 突破机制保持不变
- 修为获取速度保持不变
- 仅调整死亡事件相关逻辑
- 修仙之路始终有挑战性

---

## 修改文件清单

1. [`src/game-engine.js`](src/game-engine.js) - 死亡事件逻辑调整
   - 第963行：气运豁免
   - 第969行：死亡伤害计算
